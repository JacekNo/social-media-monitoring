<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TEB Social Auditor v3.0</title>
    <style>
        :root {
            --teb-blue: #003399;
            --teb-yellow: #FFCC00;
            --bg-gray: #f0f2f5;
            --status-ok-bg: #e7f3ff;
            --status-ok-border: #1877F2;
            --status-alert-bg: #ffebeb;
            --status-alert-border: #dc3545;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-gray);
            margin: 0;
            padding: 0;
            padding-bottom: 50px;
        }

        /* --- HEADER (PASEK G√ìRNY) --- */
        .header {
            background-color: white;
            padding: 15px 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 20px;
            border-bottom: 4px solid var(--teb-blue);
            flex-wrap: wrap;
        }

        .brand { 
            font-weight: bold; 
            color: var(--teb-blue); 
            font-size: 1.2rem;
            white-space: nowrap;
        }

        .search-container { 
            flex-grow: 1; 
            min-width: 200px;
            max-width: 600px; 
        }
        
        input[type="text"] {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #ddd;
            border-radius: 20px;
            font-size: 1rem;
            outline: none;
            transition: border-color 0.3s;
        }
        input[type="text"]:focus { border-color: var(--teb-blue); }

        .progress-info {
            font-size: 0.9rem;
            font-weight: bold;
            color: #555;
            text-align: right;
            white-space: nowrap;
        }

        .reset-btn {
            font-size: 0.8rem;
            color: #d93025;
            cursor: pointer;
            text-decoration: underline;
            margin-left: 10px;
        }

        /* --- GRID (SIATKA KART) --- */
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(420px, 1fr));
            gap: 20px;
            padding: 20px;
            max-width: 1800px;
            margin: 0 auto;
        }

        /* --- KARTA MIASTA --- */
        .city-card {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        /* Stylizacja stan√≥w (OK / ALERT) */
        .city-card.status-ok {
            border-color: var(--status-ok-border);
            background-color: var(--status-ok-bg);
        }
        
        /* Ukrywamy feedy, gdy status jest OK (oszczƒôdno≈õƒá miejsca) */
        .city-card.status-ok .feeds-wrapper { display: none; }
        .city-card.status-ok .checked-msg { display: block; }

        .city-card.status-alert {
            border-color: var(--status-alert-border);
            background-color: var(--status-alert-bg);
        }

        .city-header {
            padding: 15px;
            background: rgba(255,255,255,0.8);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #eee;
        }

        .city-header h2 { margin: 0; font-size: 1.1rem; color: #333; }
        
        .external-links a {
            font-size: 0.8rem;
            text-decoration: none;
            color: #1877F2;
            margin-left: 8px;
            font-weight: 500;
        }

        /* --- PANEL PRZYCISK√ìW --- */
        .control-panel {
            display: flex;
            padding: 10px;
            gap: 10px;
            background: rgba(255,255,255,0.5);
            border-bottom: 1px solid #eee;
            justify-content: center;
        }

        .btn {
            border: none;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            transition: transform 0.1s, background 0.2s;
        }
        .btn:active { transform: scale(0.95); }

        .btn-ok { background-color: #e4e6eb; color: #1c1e21; }
        .btn-ok:hover { background-color: #a8dadc; }
        
        .btn-alert { background-color: #e4e6eb; color: #1c1e21; }
        .btn-alert:hover { background-color: #f8d7da; color: #721c24; }

        /* Kolory aktywnych przycisk√≥w */
        .status-ok .btn-ok { background-color: #1877F2; color: white; }
        .status-alert .btn-alert { background-color: #dc3545; color: white; }

        /* --- RAMKI FACEBOOKA --- */
        .feeds-wrapper {
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .fb-frame-container {
            background: white;
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        iframe {
            width: 100%;
            height: 500px;
            border: none;
            display: block;
        }

        .checked-msg {
            display: none;
            text-align: center;
            padding: 20px;
            color: #1877F2;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .refresh-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            z-index: 10;
            background: rgba(255,255,255,0.8);
            border: 1px solid #ccc;
            font-size: 0.7rem;
            padding: 2px 6px;
            cursor: pointer;
            border-radius: 4px;
        }
        .refresh-btn:hover { background: white; }

    </style>
</head>
<body>

    <div class="header">
        <div class="brand">TEB AUDITOR</div>
        <div class="search-container">
            <input type="text" id="searchInput" placeholder="Szukaj miasta (np. Gorz√≥w, Wroc≈Çaw)..." autofocus>
        </div>
        <div class="progress-info">
            Sprawdzono: <span id="progressCount">0</span> / 46
            <br>
            <span class="reset-btn" onclick="resetAll()">Resetuj wszystko</span>
        </div>
    </div>

    <div id="app" class="dashboard"></div>

    <script>
        // --- 1. BAZA DANYCH (Pe≈Çna lista z wyjƒÖtkami z Twojej listy) ---
        // eduId = ID Fanpage'a Edukacja
        // schoolId = ID Fanpage'a Szko≈Çy (Liceum/Technikum)
        // Je≈õli brak ID, system u≈ºyje domy≈õlnego: TEBEdukacja[Slug]
        
        const oddzialy = [
            { miasto: "Be≈Çchat√≥w", slug: "Belchatow" },
            { miasto: "Bia≈Çystok", slug: "Bialystok" },
            { miasto: "Bielsko-Bia≈Ça", slug: "BielskoBiala" },
            { miasto: "Bydgoszcz", slug: "Bydgoszcz" },
            
            // Czƒôstochowa: kr√≥tki link
            { miasto: "Czƒôstochowa", slug: "Czestochowa", eduId: "TEBCzestochowa" },
            
            { miasto: "Gda≈Ñsk", slug: "Gdansk" },
            { miasto: "Gdynia", slug: "Gdynia" },
            { miasto: "Gliwice", slug: "Gliwice" },
            { miasto: "Gniezno", slug: "Gniezno" },
            
            // Gorz√≥w: ma≈Çe litery w edu, Wlkp w szko≈Çach
            { miasto: "Gorz√≥w Wlkp.", slug: "GorzowWielkopolski", eduId: "tebedukacjagorzow", schoolId: "TEBLiceumTechnikumGorzowWlkp" },
            
            // GrudziƒÖdz: standard, ale z listy
            { miasto: "GrudziƒÖdz", slug: "Grudziadz", eduId: "TEBEdukacjaGrudziadz" },
            
            // Jastrzƒôbie: specyficzne nazwy
            { miasto: "Jastrzƒôbie-Zdr√≥j", slug: "JastrzebieZdroj", eduId: "TEBJastrzebie", schoolId: "TEBLiceumTechnikumJastrzebie" },
            
            { miasto: "Jelenia G√≥ra", slug: "JeleniaGora" },
            { miasto: "Kalisz", slug: "Kalisz" },
            { miasto: "Katowice", slug: "Katowice" },
            { miasto: "Kielce", slug: "Kielce" },
            { miasto: "Koszalin", slug: "Koszalin" },
            { miasto: "Krak√≥w", slug: "Krakow" },
            { miasto: "Legnica", slug: "Legnica" },
            
            // Leszno: kr√≥tki link edu
            { miasto: "Leszno", slug: "Leszno", eduId: "TEBLeszno" },
            
            // Lubin: ma≈Çe litery + Technikum
            { miasto: "Lubin", slug: "Lubin", eduId: "teblubin", schoolId: "TEBTechnikumLubin" },
            
            // Lublin: ma≈Çe litery
            { miasto: "Lublin", slug: "Lublin", eduId: "teblublin" },
            
            { miasto: "≈Å√≥d≈∫", slug: "Lodz" },
            
            // Nowy SƒÖcz: ma≈Çe litery
            { miasto: "Nowy SƒÖcz", slug: "NowySacz", eduId: "tebnowysacz" },
            
            { miasto: "Olsztyn", slug: "Olsztyn" },
            
            // Opole: kr√≥tki link
            { miasto: "Opole", slug: "Opole", eduId: "TEBOpole" },
            
            // Ostr√≥w: kr√≥tki edu, d≈Çugi szkolny z Wlkp
            { miasto: "Ostr√≥w Wlkp.", slug: "OstrowWielkopolski", eduId: "TEBOstrowWlkp", schoolId: "TEBLiceumTechnikumOstrowWlkp" },
            
            { miasto: "Pi≈Ça", slug: "Pila" },
            
            // Piotrk√≥w: bez Trybunalski
            { miasto: "Piotrk√≥w Tryb.", slug: "PiotrkowTrybunalski", eduId: "TEBEdukacjaPiotrkow", schoolId: "TEBLiceumTechnikumPiotrkow" },
            
            // P≈Çock: kr√≥tki link
            { miasto: "P≈Çock", slug: "Plock", eduId: "TEBPlock" },
            
            { miasto: "Pozna≈Ñ", slug: "Poznan" },
            { miasto: "Racib√≥rz", slug: "Raciborz" },
            { miasto: "Radom", slug: "Radom" },
            { miasto: "Rybnik", slug: "Rybnik" },
            { miasto: "Rzesz√≥w", slug: "Rzeszow" },
            { miasto: "S≈Çupsk", slug: "Slupsk" },
            
            // Starogard: kr√≥tki link
            { miasto: "Starogard Gd.", slug: "StarogardGdanski", eduId: "TEBEdukacjaStarogard" },
            
            { miasto: "Szczecin", slug: "Szczecin" },
            
            // ≈öwidnica: specyficzny link szkolny
            { miasto: "≈öwidnica", slug: "Swidnica", schoolId: "TEBLiceumSwidnica" },
            
            { miasto: "Toru≈Ñ", slug: "Torun" },
            
            // Tychy: kr√≥tki link
            { miasto: "Tychy", slug: "Tychy", eduId: "TEBTychy" },
            
            { miasto: "Wa≈Çbrzych", slug: "Walbrzych" },
            { miasto: "Warszawa", slug: "Warszawa" },
            
            // Wodzis≈Çaw: bez ≈ölƒÖski
            { miasto: "Wodzis≈Çaw ≈öl.", slug: "WodzislawSlaski", eduId: "TEBEdukacjaWodzislaw" },
            
            { miasto: "Wroc≈Çaw", slug: "Wroclaw" },
            { miasto: "Zamo≈õƒá", slug: "Zamosc" }
        ];

        // --- 2. ZARZƒÑDZANIE STANEM (LOCAL STORAGE) ---
        let auditState = JSON.parse(localStorage.getItem('tebAuditState')) || {};

        function saveState() {
            localStorage.setItem('tebAuditState', JSON.stringify(auditState));
            updateProgress();
        }

        function updateProgress() {
            const count = Object.keys(auditState).length;
            document.getElementById('progressCount').innerText = count;
        }

        function resetAll() {
            if(confirm("Czy na pewno chcesz zresetowaƒá ca≈Çy postƒôp? Wszystkie miasta wr√≥cƒÖ do stanu 'Nie sprawdzone'.")) {
                auditState = {};
                saveState();
                render(document.getElementById('searchInput').value);
            }
        }

        function setStatus(slug, status) {
            if (auditState[slug] === status) {
                delete auditState[slug]; // Odznacz je≈õli klikniƒôto to samo
            } else {
                auditState[slug] = status;
            }
            saveState();
            
            // Od≈õwie≈º widok konkretnej karty
            const card = document.getElementById(`card-${slug}`);
            if(card) updateCardVisuals(card, slug);
        }

        function updateCardVisuals(card, slug) {
            card.classList.remove('status-ok', 'status-alert');
            const status = auditState[slug];
            if (status === 'OK') card.classList.add('status-ok');
            if (status === 'ALERT') card.classList.add('status-alert');
        }

        // --- 3. GENEROWANIE RAMEK FB ---
        function createFbIframe(pageName) {
            const encodedUrl = encodeURIComponent(`https://www.facebook.com/${pageName}`);
            
            // show_facepile=false: Kluczowe, ≈ºeby dzia≈Ça≈Ço przy zalogowaniu
            const src = `https://www.facebook.com/plugins/page.php?href=${encodedUrl}&tabs=timeline&width=400&height=500&small_header=true&adapt_container_width=true&hide_cover=false&show_facepile=false&appId`;

            return `
                <div class="fb-frame-container">
                    <button class="refresh-btn" onclick="this.parentElement.querySelector('iframe').src += ''">üîÑ Od≈õwie≈º</button>
                    <iframe src="${src}" allow="autoplay; clipboard-write; encrypted-media; picture-in-picture; web-share"></iframe>
                </div>
            `;
        }

        // --- 4. RENDEROWANIE WIDOKU ---
        const appContainer = document.getElementById('app');
        const searchInput = document.getElementById('searchInput');

        function render(filter = "") {
            appContainer.innerHTML = "";
            
            const filtered = oddzialy.filter(item => 
                item.miasto.toLowerCase().includes(filter.toLowerCase())
            );

            filtered.forEach(city => {
                const card = document.createElement('div');
                card.id = `card-${city.slug}`;
                card.className = 'city-card';
                
                // Sprawd≈∫ stan przy ≈Çadowaniu
                const currentStatus = auditState[city.slug];
                if(currentStatus === 'OK') card.classList.add('status-ok');
                if(currentStatus === 'ALERT') card.classList.add('status-alert');

                // Ustalanie link√≥w (WyjƒÖtki vs Standard)
                const eduPage = city.eduId ? city.eduId : `TEBEdukacja${city.slug}`;
                const schoolPage = city.schoolId ? city.schoolId : `TEBLiceumTechnikum${city.slug}`;

                card.innerHTML = `
                    <div class="city-header">
                        <h2>${city.miasto}</h2>
                        <div class="external-links">
                            <a href="https://fb.com/${eduPage}" target="_blank">Edu ‚Üó</a>
                            <a href="https://fb.com/${schoolPage}" target="_blank">Szko≈Çy ‚Üó</a>
                        </div>
                    </div>
                    
                    <div class="control-panel">
                        <button class="btn btn-ok" onclick="setStatus('${city.slug}', 'OK')">‚úÖ OK (Zwi≈Ñ)</button>
                        <button class="btn btn-alert" onclick="setStatus('${city.slug}', 'ALERT')">üî¥ ALERT</button>
                    </div>

                    <div class="checked-msg">
                        ‚úÖ Oddzia≈Ç sprawdzony<br>
                        <small style="cursor:pointer; color:#666; text-decoration:underline" onclick="setStatus('${city.slug}', 'OK')">Kliknij, aby rozwinƒÖƒá ponownie</small>
                    </div>

                    <div class="feeds-wrapper">
                        ${createFbIframe(eduPage)}
                        ${createFbIframe(schoolPage)}
                    </div>
                `;
                appContainer.appendChild(card);
            });
            
            if(filtered.length === 0) {
                appContainer.innerHTML = '<div style="grid-column:1/-1; text-align:center; padding:30px; color:#777">Nie znaleziono miasta.</div>';
            }
        }

        // --- 5. INITIALIZACJA ---
        searchInput.addEventListener('input', (e) => render(e.target.value));
        
        // Start aplikacji
        updateProgress();
        render("");

    </script>
</body>
</html>
